---
title: Juvenile Snowshoe Hares in Bonanza Creek Experimental Forest
author: "Devon Rossi"
date: "11/7/2021"
output: html_document
---
#### Setup
```{r setup, include= TRUE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(janitor)
library(here)
library(lubridate)
library(kableExtra)
library(dplyr)
library(broom)
#Attach packages
```

### 1. Overview
Introduction: A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know what’s contained in the report.

### 2. Data and Methods
Data and analyses: A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

### 3. Preliminary results: Juvenile Hare Initial Investigation

#### Read in bonanza hares data
```{r}
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```


#### A. Annual juvenile hare trap counts
Count the total number of juvenile hare trappings during each year of the study, and create a finalized data visualization of the counts by year. Include a figure caption below the figure in your report. 

##### Data Wrangling
```{r}
juvenile_hares <- bonanza_hares %>% 
  filter(age == "j") %>% #filter for juvenile hares
  mutate(date_new = mdy(date)) %>% #new column for date
  mutate(year = year(date_new)) %>% #new column for year
  group_by(year) #group by year

```

#### Summary Statistics - Mean, Median, and SD + Create Summary Table
```{r}
juvenile_hares_count <- juvenile_hares %>% 
  summarize(hare_count = n()) %>% #count total # of juvenile hare trappings
  summarize(mean_count = mean(hare_count, na.rm = TRUE), 
            median_count = median(hare_count, na.rm = TRUE),
            sd_count = sd(hare_count, na.rm = TRUE))
#find mean, median, and sd for juvenile hare count

juvenile_hares_count %>% #create table for summary stats for # of traps
  kbl() %>% 
  kable_styling()
```

#### Data Visualization
```{r}
ggplot(data = juvenile_hares, aes(x = year)) +
  geom_bar(bins = 5, color = "steelblue4", fill = "steelblue3") +
  theme_update() +
  scale_x_continuous(breaks = 1999:2012) +
  scale_y_continuous() +
  labs(title = "Annual Juvenile Hare Trap Counts",
       x = "Year",
       y = "Trap Counts",
       caption = "Table 1: Juvenile hare trap counts from 1999 - 2012") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.title = element_text(face = "bold", size = 12)) +
  theme(axis.title = element_text(face = "bold", size = 10))
```

What were the minimum and maximum counts of juvenile hare trappings?
Max = 126 traps in 1999
Min = 2 traps in 2010

Mean or median annual number of juvenile hares trapped?
mean_count	median_count	sd_count
31.5	       18.5	        35.88492

General/notable trends?

These are absolute counts, but this count is also impacted by effort (e.g. the number of days and number of traps in the study each year).

What would you suggest be done moving forward (you are not expected to actually do this) to standardize the juvenile hare population in future analyses?



#### B. Visualize juvenile hare weights
Create a finalized data visualization (or visualizations) in which you compare **juvenile hare weights by sex and site (grid)** (ignore other variables). You should include groups where these variables are not recorded (`NA`). Include finalized figure captions below your visualization(s).

#### Data Visualization
```{r}
juvenile_hare_weights <- juvenile_hares %>% 
  select(weight, sex, grid) %>% 
  mutate(grid_full = case_when(
    grid == "bonbs" ~ "Black Spruce",
    grid == "bobmat" ~ "Mature",
    grid == "bonrip" ~ "Riparian")) %>% 
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male"))

ggplot(data = juvenile_hare_weights, aes(x = sex, y = weight)) +
  geom_jitter(aes(color = sex, color = NA), size = 2) +
  geom_boxplot(fill = NA) +
  scale_color_manual(values = c("darkorchid4", "darkorange1", "lavenderblush")) +
  theme_light() +
  theme(legend.position = "none") +
  facet_wrap(~ grid) + #remember to connect ggplot to labs with '+'
  labs(title = "Juvenile Hare Weights by Sex and Site",
       x = "Sex",
       y = "Site",
       caption = "Table 2: Juvenile hare weight comparison by sex and site") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.title = element_text(face = "bold", size = 12)) +
  theme(axis.title = element_text(face = "bold", size = 10))

```
Then, in 2 - 3 sentences below your visualization(s) describe in text the main takeaways that you would want the audience to understand from your figures.



#### C. Juvenile weight comparison (male & female snowshoe hares)
Further compare mean weights for **juvenile male and female snowshoe hares** included in this study. In this section, you should include:

A finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares, with a table caption (remember, a table caption should be placed *above* the table in your report)

#### Summary Statistics
```{r}
juvenile_hare_weight_comparison <- juvenile_hares %>% 
  select(sex, weight) %>% #select sex & weight
  group_by(sex) %>% 
  drop_na(weight) #get rid of NA weight values

juvenile_hare_summary <- juvenile_hare_weight_comparison %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE),
        median_weight = median(weight, na.rm = TRUE),
        sd_weight = sd(weight, na.rm = TRUE),
        n = n()) #how many are there

juvenile_hare_summary %>% #create summary table for weight comparison
  kbl() %>% 
  kable_styling()
                                              
```

Note: Exploratory graphs (e.g. histograms, QQ-plots) to explore assumptions of your t-test should not show up in your final knitted document, but you DO still need to create and think about them to determine whether a t-test is appropriate. If you want keep the code chunk containing those exploratory visualizations in your .Rmd but not appear in the knitted doc, you can add `include = FALSE` in the code chunk header.

#### Exploratory Histogram
```{r}
ggplot(data = juvenile_hare_weight_comparison, aes(x = weight)) +
  geom_histogram(bins = 12) +
  facet_wrap(~sex)
```

#### Exploratory QQ-plot
```{r}
ggplot(data = juvenile_hare_weight_comparison, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)
```

#### T-Test
```{r}
female_hare_weight <- juvenile_hare_weight_comparison %>% #female weight vector
  filter(sex == "female") %>% 
  drop_na(weight) %>% #drop na weights
  pull(weight)
  

male_hare_weight <- juvenile_hare_weight_comparison %>% #male weight vector
  filter(sex == "male") %>% 
  drop_na(weight) %>% #drop na weights
  pull(weight)

hare_t <- t.test(female_hare_weight, male_hare_weight)
```

#### Cohen's d Effect Size
```{r}
hare_cohen <- cohen.d(female_hare_weight, male_hare_weight)
```
A 2 - 3 sentence comprehensive statement of the means comparison, including at least:
The actual difference in means
Effect size (Cohen's *d*) (see effsize::cohen.d() example in the Lab 5 key)
Outcome of an unpaired two-sample t-test

#### D. Relationship between juvenile weight & hind foot length
Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

#### Exploratory Scatterplot for Linear Regression
```{r}
ggplot(data = juvenile_hares, aes(x = hindft, y = weight)) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_get() +
  labs(title = "Hind Foot Length and Weight",
       x = "Hind Foot (mm)",
       y = "Weight (kg)")

```




#### Simple Linear Regression
```{r}
hare_lm <- lm(hindft ~ weight, data = juvenile_hares)


hare_lm_tidy <- tidy(hare_lm)


hare_lm_glance <- glance(hare_lm)


extract_eq(model = hare_lm, use_coefs = TRUE)

plot(hare_lm)

cor.test(juvenile_hares$hindft, juvenile_hares$weight)

```
In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 

## Summary
Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)


## Citations
Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

